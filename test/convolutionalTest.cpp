#include "ConvolutionalEncoder.hpp"
#include "catch2/catch_all.hpp"
#include <fstream>

TEST_CASE("Convolutional Encoder") {
    ConvolutionalEncoder convolutional;
    etl::bitset<ConvolutionalEncoder::inputLength> input;
    etl::bitset<ConvolutionalEncoder::outputLength> output;
    etl::bitset<ConvolutionalEncoder::outputLength> expectedOutput;
    SECTION("Convolutional-Test no1: Zeros") {
        for (int i = 0; i < ConvolutionalEncoder::inputLength; i++) {
            input.set(i,0);
        }
        convolutional.encode(input, output);

        uint16_t errors = 0;
        for (int i = 0; i < ConvolutionalEncoder::outputLength; i++) {
            if (output[i] != 0) {
                errors += 1;
            }
        }
        CHECK(errors == 0);
    }
    SECTION("Convolutional-Test no2: Random Word") {
        input = "01100111001100110010011000000100110100111010110100101011111110001000111010100000110101011111000011011101010000111101100101001100100111110010011000110111101101101001100100110111001010001011111001000010100000111011111001111010101111111100111101010101010010001111100000110100010111010000101011000010010001010010111110100110111111110000011110100011111100100000111010011010010000100110000101101010001111101101010100110011001100110101000000101110010010001011000110110010011000010101101011101011010111110000100110010001111101000011000010101011001001111000101011010010100010101010001100010001110001101000000101100111001111101001000000111001111001001101011110111000010111111101011011110010110010001000001111100101010010110001011110101101100101110011011101111000101110110000000001111000011010100001001010010110111101100101101111100111010111000101000111011111110000001001111011100110010100101110010010100100011000011101110011111001001001001111000111010100110001000110011010010011001010001101000010110001101001001100011010011101101001100111001000110011100000111010001101100100000110011110101001101001011011110010011010010111000000011000101000100001100010001000010011100110001110101001101011000010101000011010110100111101101001010011010110011001000110101011110111100010011110001100101011111001100011100011110011111110000011101111100010000110010000100010000011001100010110110100000001100001001000100011111011111101110111010010010011011100111011001000100111111110100100110111111111111001100100101010001100110111000010001101010101100011111011011101101010001000011011111001111110010101001010000111000010110010011110001101100101100011100100001001111110110101101101000011010011111110011011000111010100000100000111011111011111110110111011011100011001010010100111001111110101100100111000011010100101010001000101001101001100011110010100000101110110011011011010110011101110001100001100001110100011010011001000010100100000110011000100010000100101010111011010001000110100011110000000100100011111000110111101011001111000000110100100101010100010001100111000001101010000110100";
        expectedOutput = "1111100010000000111100001100101110110000101011111000001011111010100100101111100010010110101010100011011110001100101010001111000010011111101100100001000110001001111111011110111010010110100001111100111011001000101001101010111101000001101101011100110010111000010111100111101110110000011101000111000110111110100010011010011100110010111011110111111110110110111011110010101110111001111000111001110111100001000101011100000010111001001101101000101111110111100011110010010011011010001011110011001100000110010000001010011110100110000110001010011111001010000011010100100111010011101011100101000001010000110001110110100110111011010001100111110111001000111100101001100001011010100001011100101001000010011110001101000101011111011001111110101010010011100100001011000010010111100101010111001011001010011101111110010111110000010111001111000011110000111100111001110010000111111011101000111011101101010000110010011011011101000100010000101110110000100101110100111001010100010000111000100101010001111011101001010100001011001100100000001010011101000101001010101100100101110100001111101000001011100001100110100000010011100101101010101011101111000100001100001011000111000100111100001001000110110100101001000111111011100110001111100010001101011101000110100100110111110101010010001101100101111011101111100100011101101100111101010101111010111000110001001000100110110001010111010101100000100000111111110100010110011110011101100000000110100101101101000010101101100010001001100001000001011000111000001101111100000000010110100000101000000011011110101100000011010110100110010110100010011100100010010000011010110110100101011011000110111101000001010101101100101110010011101111100001001101100000011110110010011100000010001100101001101111100000100001101011001111100000001100011011011010011000111011101101101011011001000000011100100110010111000011111000110101111001111011010111010111100001100110101110011111101100010111000001001111000001111111001110101010011110110011000110111011000100101001001001111001101101110100101010100111101100000111010010101001001011001110011010011100111111100010111000000001111111111000010110000101011111010111000100010001000010001101000110111111110110100010110001011111101010101001010110110001010111101110111110101010100110001101011011001101101100010000011110111111111110101011000100111100111111111001000010001000100000000001111001111110110001011111100100101011100101110100000010001010100010010010010110100100011010111110011010101010110101111110010010100011000011001000000001001001111111011101101100000101101000110010000110011010110111110001100011011110111001000000000111100100011011101010010100110101001100101001100001010111000000101110101000111111101010111100100011100100110011111111010001101111110000000100001001011000100110010001110011011011001001010000010100001111110000101001110111000010000001110011000000110011011010011101011110111101111111100011101100110100001000001111001000010100111100010001101001111011110111001000111111111111001001000000110010110110100000001011000111111100110111111101010101001100000100100111110011111010110111101001110111111010111100001110010111001011111111111010100001110010111001001101010000100111011000000001101010111000101001010001010101111001100000101110000110011010110100010001000001010110110111100100101110001110010000100001010000011111100101001001100010011001001010100010101001000101001100100100001101000111011110011111101100100001001000111101000101011100000010110111000010001100011111101011110000111010111111011011011111000110110110101011010100100010001101010000010010001010000010111000100001010110100010011100011010100000001011111111001100011101011111101010011100000111101010010111011011100001001011101000000011010011001101001010001001010010100011111011000011110110110111001001101011001001100101111101011100010010101001110011001000111001110111011001001101000110111111000000010011110011111111100100000110100000111101000000111001100111111111000001001010011100101010011001101100111000000101000000101001111010101101000111000110001000101000111101100110011011110110001010101001110110100000110000101111111100000111111111100001011000011000100111001000101010001010010001110000";
        convolutional.encode(input, output);
        uint16_t errors = 0;
        for (int i = 0; i < ConvolutionalEncoder::outputLength; i++) {
            if (output[i] != expectedOutput[i]) {
                errors += 1;
            }
        }
            CHECK(errors == 0);
    }
}

